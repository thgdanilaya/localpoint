<!DOCTYPE html>


<html lang="en">
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>2GIS Map API</title>
		<meta name="description" content="Quickstart with 2GIS Map API" />
		<style>
			html,
			body,
			container {
				margin: auto;
				width: 100%;
				height: 100%;
				overflow: hidden;
			}
		</style>
	</head>
	<body>
		<div id="container" style="position: absolute; bottom: 0; width: 100%; height: 85%; "></div>

		<script src="https://mapgl.2gis.com/api/js/v1"></script>

		<button class="w-100 mb-2 btn btn-lg rounded-3 btn-primary" type="submit" id="addMarker">Добавить точку</button>

		<script>
			const map = new mapgl.Map('container', {
    			key: 'e307d86e-ae84-43c8-9abd-a5532d361f08',
    			center: [37.622563, 55.753572],
    			zoom: 13,
			});

			var isNextClicked = false;

			map.on('click', (e) => {
				var lat = String(e.lngLat[1]);
				var lot = String(e.lngLat[0]);
				var manKey = 'rupxdx6365';
				var requestURL = 'https://catalog.api.2gis.com/3.0/items/geocode?lat=' + lat + '&lon=' + lot + '&fields=items.point&key=' + manKey;

				var xmlHttp = new XMLHttpRequest();
    			xmlHttp.open("GET", requestURL, false);
    			xmlHttp.send(null);
    			console.log(JSON.parse(xmlHttp.responseText)['result']['items'][0]['full_name']);

    			const marker = new mapgl.Marker(map, {
    				coordinates: [e.lngLat[0], e.lngLat[1]],
    				label: {
       					text: JSON.parse(xmlHttp.responseText)['result']['items'][0]['full_name'],
       					offset: [0, 25],
        				relativeAnchor: [0.5, 0],
        				image: {
            				url: 'https://docs.2gis.com/img/mapgl/tooltip-top.svg',
            				size: [100, 50],
            				stretchX: [
                				[10, 40],
                				[60, 90],
            				],
            				stretchY: [[20, 40]],
           				 	padding: [20, 10, 10, 10],
        				},
   				 	},
				});

				addMarker.onclick = function() {
   					alert('ADD CURRENT MARKER');
  				};

				map.on('click', (e) => {
					if (!isNextClicked) {
						isNextClicked = true;
					}
					marker.destroy();
				});
			});
		</script>
	</body>
</html>
